{% set page = {
  title: 'index',
  dev: true,
  secondary: true,
  html_classes: ['page-class']
} %}

{% extends page.layout | d(prototype.current.layout) %}

{% block primary %}
  <h1 class="heading-xlarge">
    Scan the barcode on your fitnote
  </h1>

  <img src="/public/images/guide-barcode-scan-2x.png" width="50%" />
  
  <div id="image-holder">
    
  </div>

  <div class="form-group">
    <label class="form-label-bold" for="scan-barcode">Scan barcode</label>
    <input type="file" accept="image/*" class="button" id="scan-barcode" name="scan-barcode">
  </div>

{% endblock %}

{% block body_end %}
  
  {{ super() }}
  
  <script language="JavaScript">
    
    var page = {
      
      handleUpload: function() {
        var self = this;
        var $input = $('#scan-barcode');
        if($input.length) {
          $input.on('change', function(e){
            
            //Get count of selected files
             var countFiles = $(this)[0].files.length;

             var imgPath = $(this)[0].value;
             var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();
             var image_holder = $("#image-holder");
             image_holder.empty();

             if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                 if (typeof (FileReader) != "undefined") {

                     //loop for each file selected for uploaded.
                     for (var i = 0; i < countFiles; i++) {

                         var reader = new FileReader();
                         reader.onload = function (e) {
                             $("<img />", {
                                 "src": e.target.result,
                                     "class": "thumb-image"
                             }).appendTo(image_holder);
                         }

                         image_holder.show();
                         reader.readAsDataURL($(this)[0].files[i]);
                         
                     }

                 } else {
                     alert("This browser does not support FileReader.");
                 }
             } else {
                 alert("Pls select only images");
             }
            
          });
        }
      },
      
      init: function() {
        var self = this;
        self.handleUpload();
      }
      
    }
    
    $(function(){
      page.init();
    });
    
	</script>
  
{% endblock %}